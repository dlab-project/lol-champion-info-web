<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>리그 오브 레전드 - 챔피언들</title>
    <link rel="stylesheet" href="styles.css">
    <script src="champion-info.js" defer></script>
</head>
<body>
    <div class="container">
        <h1>리그 오브 레전드 챔피언들</h1>

        <div class="champions-grid">
            <!-- 아트록스 -->
            <div class="champion" data-champion-id="Aatrox" onclick="showChampionModal('Aatrox')">
                <h2>아트록스</h2>
                <p class="subtitle">다르킨의 검</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Aatrox_0.jpg" 
                     alt="아트록스 챔피언 이미지" 
                     class="champion-image">
            </div>

            <!-- 추가 챔피언들 -->
            <div class="champion" data-champion-id="Ahri" onclick="showChampionModal('Ahri')">
                <h2>아리</h2>
                <p class="subtitle">구미호</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Ahri_0.jpg" alt="아리" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Kennen" onclick="showChampionModal('Kennen')">
                <h2>케넨</h2>
                <p class="subtitle">폭풍의 심장</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Kennen_0.jpg" alt="케넨" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Olaf" onclick="showChampionModal('Olaf')">
                <h2>올라프</h2>
                <p class="subtitle">광전사</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Olaf_0.jpg" alt="올라프" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Anivia" onclick="showChampionModal('Anivia')">
                <h2>애니비아</h2>
                <p class="subtitle">얼음불사조</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Anivia_0.jpg" alt="애니비아" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Malphite" onclick="showChampionModal('Malphite')">
                <h2>말파이트</h2>
                <p class="subtitle">암석의 파편</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Malphite_0.jpg" alt="말파이트" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Jinx" onclick="showChampionModal('Jinx')">
                <h2>징크스</h2>
                <p class="subtitle">난폭한 말괄량이</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Jinx_0.jpg" alt="징크스" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Yasuo" onclick="showChampionModal('Yasuo')">
                <h2>야스오</h2>
                <p class="subtitle">용서받지 못한 자</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Yasuo_0.jpg" alt="야스오" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Lux" onclick="showChampionModal('Lux')">
                <h2>럭스</h2>
                <p class="subtitle">광명의 소녀</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Lux_0.jpg" alt="럭스" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Garen" onclick="showChampionModal('Garen')">
                <h2>가렌</h2>
                <p class="subtitle">데마시아의 힘</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Garen_0.jpg" alt="가렌" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Riven" onclick="showChampionModal('Riven')">
                <h2>리븐</h2>
                <p class="subtitle">추방당한 자</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Riven_0.jpg" alt="리븐" class="champion-image">
            </div>
            <div class="champion" data-champion-id="MissFortune" onclick="showChampionModal('MissFortune')">
                <h2>미스 포춘</h2>
                <p class="subtitle">현상금 사냥꾼</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/MissFortune_0.jpg" alt="미스 포춘" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Thresh" onclick="showChampionModal('Thresh')">
                <h2>쓰레쉬</h2>
                <p class="subtitle">사슬 파수꾼</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Thresh_0.jpg" alt="쓰레쉬" class="champion-image">
            </div>
            <div class="champion" data-champion-id="LeeSin" onclick="showChampionModal('LeeSin')">
                <h2>리신</h2>
                <p class="subtitle">눈먼 수도승</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/LeeSin_0.jpg" alt="리신" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Vayne" onclick="showChampionModal('Vayne')">
                <h2>베인</h2>
                <p class="subtitle">어둠 사냥꾼</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Vayne_0.jpg" alt="베인" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Ezreal" onclick="showChampionModal('Ezreal')">
                <h2>이즈리얼</h2>
                <p class="subtitle">무모한 탐험가</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Ezreal_0.jpg" alt="이즈리얼" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Katarina" onclick="showChampionModal('Katarina')">
                <h2>카타리나</h2>
                <p class="subtitle">사악한 칼날</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Katarina_0.jpg" alt="카타리나" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Jhin" onclick="showChampionModal('Jhin')">
                <h2>진</h2>
                <p class="subtitle">잔혹극의 거장</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Jhin_0.jpg" alt="진" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Fiora" onclick="showChampionModal('Fiora')">
                <h2>피오라</h2>
                <p class="subtitle">최고의 검사</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Fiora_0.jpg" alt="피오라" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Teemo" onclick="showChampionModal('Teemo')">
                <h2>티모</h2>
                <p class="subtitle">날쌘 정찰병</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Teemo_0.jpg" alt="티모" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Shen" onclick="showChampionModal('Shen')">
                <h2>쉔</h2>
                <p class="subtitle">황혼의 눈</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Shen_0.jpg" alt="쉔" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Darius" onclick="showChampionModal('Darius')">
                <h2>다리우스</h2>
                <p class="subtitle">녹서스의 실력자</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Darius_0.jpg" alt="다리우스" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Soraka" onclick="showChampionModal('Soraka')">
                <h2>소라카</h2>
                <p class="subtitle">별의 아이</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Soraka_0.jpg" alt="소라카" class="champion-image">
            </div>
            <div class="champion" data-champion-id="Zed" onclick="showChampionModal('Zed')">
                <h2>제드</h2>
                <p class="subtitle">그림자의 주인</p>
                <img src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Zed_0.jpg" alt="제드" class="champion-image">
            </div>
        </div>
    </div>

    <!-- 챔피언 정보 모달 -->
    <div id="championModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2 id="modalTitle">챔피언 정보</h2>
            </div>
            <div class="modal-body">
                <div id="modalLoading" class="loading">
                    <div class="loading-spinner"></div>
                    <p>챔피언 정보를 불러오는 중...</p>
                </div>
                <div id="modalContent" style="display: none;">
                    <!-- 동적으로 채워질 내용 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수로 선언
        let championService;

        // 모달 표시 함수
        async function showChampionModal(championId) {
            const modal = document.getElementById('championModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalLoading = document.getElementById('modalLoading');
            const modalContent = document.getElementById('modalContent');

            // championService 초기화 확인
            if (!championService) {
                console.error('ChampionInfoService가 아직 초기화되지 않았습니다.');
                return;
            }

            // 모달 열기
            modal.style.display = 'block';
            modalLoading.style.display = 'block';
            modalContent.style.display = 'none';
            modalTitle.textContent = '챔피언 정보를 불러오는 중...';

            try {
                console.log(`요청한 챔피언 ID: ${championId}`); // 디버깅용
                
                // 챔피언 정보 가져오기
                const championInfo = await championService.getChampionInfo(championId);
                
                // 모달 내용 업데이트
                modalTitle.textContent = `${championInfo.basic.name} - ${championInfo.basic.title}`;
                updateModalContent(championInfo);
                
                // 로딩 숨기고 내용 표시
                modalLoading.style.display = 'none';
                modalContent.style.display = 'block';
            } catch (error) {
                console.error('챔피언 정보를 가져오는데 실패했습니다:', error);
                modalLoading.innerHTML = `
                    <div class="error">
                        <p>❌ 챔피언 정보를 불러오는데 실패했습니다.</p>
                        <p>요청한 챔피언: ${championId}</p>
                        <p>에러: ${error.message}</p>
                        <button class="btn" onclick="checkChampionIds()">전체 챔피언 ID 확인</button>
                    </div>
                `;
            }
        }

        // 전체 챔피언 ID 확인 함수 (디버깅용)
        async function checkChampionIds() {
            if (!championService) {
                console.error('ChampionInfoService가 아직 초기화되지 않았습니다.');
                alert('서비스가 아직 로딩 중입니다. 잠시 후 다시 시도해주세요.');
                return;
            }

            try {
                const mapping = await championService.getChampionIdMapping();
                console.log('=== 현재 HTML에서 사용하는 챔피언 ID들 ===');
                const htmlIds = [
                    'Aatrox', 'Ahri', 'Kennen', 'Olaf', 'Anivia', 'Malphite', 'Jinx', 'Yasuo', 
                    'Lux', 'Garen', 'Riven', 'MissFortune', 'Thresh', 'LeeSin', 'Vayne', 
                    'Ezreal', 'Katarina', 'Jhin', 'Fiora', 'Teemo', 'Shen', 'Darius', 'Soraka', 'Zed'
                ];
                
                htmlIds.forEach(id => {
                    if (mapping[id]) {
                        console.log(`✅ ${id} - 올바름`);
                    } else {
                        console.log(`❌ ${id} - 잘못된 ID`);
                        // 비슷한 이름 찾기
                        const similar = Object.keys(mapping).filter(key => 
                            key.toLowerCase().includes(id.toLowerCase()) || 
                            id.toLowerCase().includes(key.toLowerCase())
                        );
                        if (similar.length > 0) {
                            console.log(`   추천: ${similar.join(', ')}`);
                        }
                    }
                });
            } catch (error) {
                console.error('챔피언 ID 확인 실패:', error);
            }
        }

        // 모달 내용 업데이트 함수
        function updateModalContent(champion) {
            const modalContent = document.getElementById('modalContent');
            
            const html = `
                <div class="champion-modal-info">
                    <div class="champion-image-section">
                        <img src="${champion.images.loading}" alt="${champion.basic.name}" class="modal-champion-image">
                        <div class="champion-tags">
                            ${champion.basic.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                        <div class="difficulty">
                            난이도: ${'★'.repeat(champion.basic.difficulty)}${'☆'.repeat(10 - champion.basic.difficulty)} (${champion.basic.difficulty}/10)
                        </div>
                    </div>
                    
                    <div class="champion-stats-section">
                        <h3>📊 기본 스탯</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-label">⚔️ 공격력</div>
                                <div class="stat-value">${Math.round(champion.stats.attack.damage)} (+${champion.stats.attack.damagePerLevel}/레벨)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">🛡️ 방어력</div>
                                <div class="stat-value">${Math.round(champion.stats.defense.armor)} (+${champion.stats.defense.armorPerLevel}/레벨)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">💙 체력</div>
                                <div class="stat-value">${Math.round(champion.stats.hp.base)} (+${champion.stats.hp.perLevel}/레벨)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">🔮 ${champion.stats.mp.type}</div>
                                <div class="stat-value">${Math.round(champion.stats.mp.base)} (+${champion.stats.mp.perLevel}/레벨)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">⚡ 공격속도</div>
                                <div class="stat-value">${champion.stats.attack.speed.toFixed(3)} (+${champion.stats.attack.speedPerLevel}%/레벨)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">🔮 마법저항력</div>
                                <div class="stat-value">${Math.round(champion.stats.defense.magicResist)} (+${champion.stats.defense.magicResistPerLevel}/레벨)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">👟 이동속도</div>
                                <div class="stat-value">${champion.stats.movement.speed}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">🎯 사거리</div>
                                <div class="stat-value">${champion.stats.attack.range}</div>
                            </div>
                        </div>

                        <h3>⭐ 역할별 평가</h3>
                        <div class="ratings-grid">
                            <div class="rating-item">
                                <span class="rating-label">공격</span>
                                <div class="rating-bar">
                                    <div class="rating-fill" style="width: ${champion.stats.ratings.attack * 10}%"></div>
                                    <span class="rating-text">${champion.stats.ratings.attack}/10</span>
                                </div>
                            </div>
                            <div class="rating-item">
                                <span class="rating-label">방어</span>
                                <div class="rating-bar">
                                    <div class="rating-fill" style="width: ${champion.stats.ratings.defense * 10}%"></div>
                                    <span class="rating-text">${champion.stats.ratings.defense}/10</span>
                                </div>
                            </div>
                            <div class="rating-item">
                                <span class="rating-label">마법</span>
                                <div class="rating-bar">
                                    <div class="rating-fill" style="width: ${champion.stats.ratings.magic * 10}%"></div>
                                    <span class="rating-text">${champion.stats.ratings.magic}/10</span>
                                </div>
                            </div>
                        </div>

                        <h3>🎮 스킬 정보</h3>
                        <div class="abilities-section">
                            <div class="ability-item passive">
                                <img src="${champion.abilities.passive.image}" alt="패시브" class="ability-icon">
                                <div class="ability-info">
                                    <h4>패시브 - ${champion.abilities.passive.name}</h4>
                                    <p>${champion.abilities.passive.description}</p>
                                </div>
                            </div>
                            ${champion.abilities.spells.map(spell => `
                                <div class="ability-item">
                                    <img src="${spell.image}" alt="${spell.key}" class="ability-icon">
                                    <div class="ability-info">
                                        <h4>${spell.key} - ${spell.name}</h4>
                                        <p>${spell.description}</p>
                                        <div class="ability-stats">
                                            <span>재사용 대기시간: ${Array.isArray(spell.cooldown) ? spell.cooldown.join('/') : spell.cooldown}초</span>
                                            ${spell.cost && spell.cost.length > 0 && spell.cost[0] > 0 ? 
                                                `<span>소모: ${Array.isArray(spell.cost) ? spell.cost.join('/') : spell.cost}</span>` : ''}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            modalContent.innerHTML = html;
        }

        // 모달 닫기 함수
        function closeModal() {
            document.getElementById('championModal').style.display = 'none';
        }

        // 모달 외부 클릭 시 닫기
        window.onclick = function(event) {
            const modal = document.getElementById('championModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // ESC 키로 모달 닫기
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        // 테스트 함수 (확실히 작동하는 챔피언으로 테스트)
        async function testAPI() {
            if (!championService) {
                console.error('ChampionInfoService가 아직 초기화되지 않았습니다.');
                console.log('페이지가 완전히 로드된 후 다시 시도해주세요.');
                return;
            }

            try {
                console.log('=== API 테스트 시작 ===');
                
                // 1. 전체 챔피언 목록 가져오기 테스트
                const allChampions = await championService.getAllChampions();
                console.log('✅ 전체 챔피언 목록 가져오기 성공:', allChampions.slice(0, 5));
                
                // 2. 간단한 챔피언 하나로 테스트 (아리)
                const ahriInfo = await championService.getChampionInfo('Ahri');
                console.log('✅ 아리 정보 가져오기 성공:', ahriInfo.basic);
                
                // 3. 챔피언 ID 매핑 확인
                await checkChampionIds();
                
            } catch (error) {
                console.error('❌ API 테스트 실패:', error);
                
                // CORS 문제인지 확인
                if (error.message.includes('CORS') || error.message.includes('blocked')) {
                    console.log('💡 CORS 문제일 수 있습니다. 로컬 서버로 실행해주세요.');
                }
            }
        }

        // 챔피언 카드에 호버 효과 추가
        document.addEventListener('DOMContentLoaded', function() {
            // ChampionInfoService 초기화
            championService = new ChampionInfoService();
            console.log('✅ ChampionInfoService 초기화 완료');

            const championCards = document.querySelectorAll('.champion');
            championCards.forEach(card => {
                card.style.cursor = 'pointer';
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-8px)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(-5px)';
                });
            });

            // 페이지 로드 시 API 테스트 실행
            console.log('페이지 로드 완료. API 테스트를 시작합니다...');
            console.log('콘솔에서 testAPI()를 실행하거나 챔피언을 클릭해보세요.');
        });
    </script>
</body>
</html>
